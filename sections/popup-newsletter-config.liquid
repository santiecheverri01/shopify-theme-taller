{% comment %}
  Configuración del Popup Newsletter - Solo para configurar, no se muestra visualmente
{% endcomment %}

{% comment %} Esta sección no renderiza nada visible, solo almacena configuraciones {% endcomment %}

<!-- Configuración oculta del popup -->

<script>
  // Sobrescribir configuraciones del popup al JavaScript global
  window.popupNewsletterSettings = Object.assign(window.popupNewsletterSettings || {}, {
    showDelay: {{ section.settings.show_delay | default: 3 | times: 1000 }},
    showOnExit: {{ section.settings.show_on_exit | default: true }},
    cookieExpiry: {{ section.settings.cookie_expiry | default: 0 }},
    showLogo: {{ section.settings.show_logo | default: false }},
    logoSource: {{ section.settings.logo_source | default: 'theme_logo' | json }},
    {% if section.settings.logo_source == 'custom_logo' and section.settings.custom_logo %}
      logoUrl: '{{ section.settings.custom_logo | image_url: width: section.settings.logo_width }}',
    {% elsif settings.logo %}
      logoUrl: '{{ settings.logo | image_url: width: section.settings.logo_width }}',
    {% else %}
      logoUrl: null,
    {% endif %}
    logoWidth: {{ section.settings.logo_width | default: 120 }},
    showImage: {{ section.settings.show_image | default: false }},
    {% assign image_size = section.settings.image_size | default: 'medium' %}
    {% case image_size %}
      {% when 'small' %}
        {% assign image_width = 300 %}
      {% when 'large' %}
        {% assign image_width = 500 %}
      {% else %}
        {% assign image_width = 400 %}
    {% endcase %}
    imageUrl: {% if section.settings.popup_image %}'{{ section.settings.popup_image | image_url: width: image_width }}'{% else %}null{% endif %},
    imageSize: {{ image_size | json }},
    title: {{ section.settings.popup_title | default: '¡Únete a nuestra comunidad!' | json }},
    showTitleIcon: {{ section.settings.show_title_icon | default: true }},
    titleIcon: {{ section.settings.title_icon | default: '✨' | json }},
    subtitle: {{ section.settings.popup_subtitle | default: 'Recibe ofertas exclusivas y mantente al día con nuestras novedades' | json }},
    buttonText: {{ section.settings.button_text | default: 'Suscribirme' | json }},
    buttonColor: {{ section.settings.button_color | default: '#111827' | json }},
    successTitle: {{ section.settings.success_title | default: '¡Gracias por suscribirte!' | json }},
    successMessage: {{ section.settings.success_message | default: 'Te hemos enviado un correo de confirmación. Revisa tu bandeja de entrada.' | json }}
  });
  
  console.log('🔄 Configuraciones del popup actualizadas desde la sección:', window.popupNewsletterSettings);
  console.log('🎯 Sección popup-newsletter-config cargada correctamente');
  
  // Forzar re-aplicación de configuraciones si el popup ya existe
  if (window.popupNewsletterInstance && window.popupNewsletterInstance.applyDynamicSettings) {
    console.log('♻️ Re-aplicando configuraciones a instancia existente...');
    window.popupNewsletterInstance.applyDynamicSettings();
  } else {
    console.log('⏳ Instancia del popup no disponible aún, se aplicará cuando se inicialice');
  }
</script>

{% schema %}
{
  "name": "Popup Newsletter Config",
  "class": "popup-newsletter-config",
  "settings": [
    {
      "type": "header",
      "content": "⚙️ Configuración del Comportamiento"
    },
      {
        "type": "range",
        "id": "show_delay",
        "min": 0,
        "max": 10,
        "step": 1,
        "unit": "s",
        "label": "⏱️ Tiempo antes de mostrar",
        "default": 3,
        "info": "Tiempo en segundos"
      },
    {
      "type": "checkbox",
      "id": "show_on_exit",
      "label": "🚪 Mostrar al intentar salir",
      "default": true,
      "info": "Mostrar popup cuando el usuario mueve el mouse fuera de la ventana"
    },
      {
        "type": "range",
        "id": "cookie_expiry",
        "min": 0,
        "max": 30,
        "step": 1,
        "unit": "d",
        "label": "🍪 Recordar por (días)",
        "default": 0,
        "info": "0 = solo por sesión, 7 = una semana"
      },
    {
      "type": "header",
      "content": "🏷️ Logo del Popup"
    },
    {
      "type": "checkbox",
      "id": "show_logo",
      "label": "Mostrar logo",
      "default": false
    },
    {
      "type": "select",
      "id": "logo_source",
      "label": "📍 Fuente del logo",
      "options": [
        {
          "value": "theme_logo",
          "label": "🎨 Usar logo del tema"
        },
        {
          "value": "custom_logo",
          "label": "📷 Subir logo personalizado"
        }
      ],
      "default": "theme_logo",
      "info": "Elige si usar el logo del tema o subir uno específico para el popup"
    },
    {
      "type": "image_picker",
      "id": "custom_logo",
      "label": "📷 Logo personalizado",
      "info": "Solo se usa si seleccionas 'Subir logo personalizado' arriba"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 60,
      "max": 200,
      "step": 10,
      "unit": "px",
      "label": "📐 Ancho del logo",
      "default": 120,
      "info": "El alto se ajusta automáticamente"
    },
    {
      "type": "header",
      "content": "🖼️ Imagen del Popup"
    },
    {
      "type": "checkbox",
      "id": "show_image",
      "label": "Mostrar imagen banner",
      "default": false
    },
    {
      "type": "image_picker",
      "id": "popup_image",
      "label": "📷 Imagen del popup"
    },
      {
        "type": "select",
        "id": "image_size",
        "label": "📏 Tamaño de imagen",
        "options": [
          {
            "value": "small",
            "label": "Small (300px)"
          },
          {
            "value": "medium",
            "label": "Medium (400px)"
          },
          {
            "value": "large",
            "label": "Large (500px)"
          }
        ],
        "default": "medium",
        "info": "El alto se ajusta automáticamente para conservar el ratio"
      },
    {
      "type": "header",
      "content": "✏️ Textos del Popup"
    },
    {
      "type": "text",
      "id": "popup_title",
      "label": "📝 Título principal",
      "default": "¡Únete a nuestra comunidad!"
    },
    {
      "type": "checkbox",
      "id": "show_title_icon",
      "label": "Mostrar icono en título",
      "default": true
    },
    {
      "type": "text",
      "id": "title_icon",
      "label": "✨ Icono del título",
      "default": "✨",
      "info": "Usa emojis como ✨ 🎉 💎 ⭐ 🎁"
    },
    {
      "type": "textarea",
      "id": "popup_subtitle",
      "label": "📄 Subtítulo",
      "default": "Recibe ofertas exclusivas y mantente al día con nuestras novedades"
    },
    {
      "type": "header",
      "content": "🎯 Beneficios"
    },
    {
      "type": "checkbox",
      "id": "show_benefits",
      "label": "Mostrar lista de beneficios",
      "default": true
    },
    {
      "type": "text",
      "id": "benefit_1_icon",
      "label": "🎁 Icono beneficio 1",
      "default": "🎁"
    },
    {
      "type": "text",
      "id": "benefit_1_text",
      "label": "Texto beneficio 1",
      "default": "Descuentos exclusivos"
    },
    {
      "type": "text",
      "id": "benefit_2_icon",
      "label": "👕 Icono beneficio 2",
      "default": "👕"
    },
    {
      "type": "text",
      "id": "benefit_2_text",
      "label": "Texto beneficio 2",
      "default": "Nuevas colecciones"
    },
    {
      "type": "text",
      "id": "benefit_3_icon",
      "label": "🎂 Icono beneficio 3",
      "default": "🎂"
    },
    {
      "type": "text",
      "id": "benefit_3_text",
      "label": "Texto beneficio 3",
      "default": "Sorpresa de cumpleaños"
    },
    {
      "type": "header",
      "content": "🎨 Personalización"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "📤 Texto del botón",
      "default": "Suscribirme"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "🎨 Color del botón",
      "default": "#111827"
    },
    {
      "type": "header",
      "content": "✅ Mensaje de Éxito"
    },
    {
      "type": "text",
      "id": "success_title",
      "label": "🎉 Título de éxito",
      "default": "¡Gracias por suscribirte!"
    },
    {
      "type": "textarea",
      "id": "success_message",
      "label": "💌 Mensaje de éxito",
      "default": "Te hemos enviado un correo de confirmación. Revisa tu bandeja de entrada."
    }
  ],
  "presets": [
    {
      "name": "Popup Newsletter Config"
    }
  ]
}
{% endschema %}
